#!/bin/bash


# if [ "${LANG:0:2}" = "pt" ]
# then
#     BIGBASHVIEW_LANG="pt"
#     sudo timedatectl set-timezone America/Sao_Paulo
#     
# elif [ "${LANG:0:2}" = "es" ]
# then
#     BIGBASHVIEW_LANG="es"
#     
# else
#     BIGBASHVIEW_LANG="en"
# fi



# Virtualization fix open
# if [ "$(lspci | grep -i vga | grep -i vmware)" != "" ]; then
#     kwriteconfig5 --file ~/.config/kded5rc --group Module-kscreen --key autoload false
# fi
# Virtualization fix close

# change clock
timedatectl set-local-rtc 1 --adjust-system-clock

if [ "$(grep 'Autolock=false' ~/.config/kscreenlockerrc)" = "" ];
then
    sed -i '/\[Daemon\]/a\'$'\n''Autolock=false\nLockOnResume=false' ~/.config/kscreenlockerrc
fi

if [ "$(grep 'Enabled=false' ~/.config/kwalletrc)" = "" ];
then
    echo '[Wallet]
Enabled=false' >> ~/.config/kwalletrc
fi

# Disable discover update in live
# sudo rm -Rf /usr/share/plasma/plasmoids/org.kde.discovernotifier
# sudo rm -f /etc/xdg/autostart/org.kde.discover.notifier.desktop
# sudo rm -f /usr/lib/x86_64-linux-gnu/libexec/DiscoverNotifier

cd /usr/share/bigbashview/bcc/apps/boot-livecd/



if [ -e "/tmp/big_desktop_theme" ]; then
    /usr/bin/bigbashview -c black -t gtk -s $(LANG=C xdpyinfo  | grep 'dimensions:' | sed 's|.*dimensions:||g;s| pixels.*||g') index.sh.htm
else
    /usr/bin/bigbashview -c black -t gtk -s $(LANG=C xdpyinfo  | grep 'dimensions:' | sed 's|.*dimensions:||g;s| pixels.*||g') index.html
fi

export LANGUAGE=$(cat /tmp/big_language).UTF-8
export LANG=$(cat /tmp/big_language).UTF-8

echo "[Formats]
LANG=$(cat /tmp/big_language).UTF-8" > $HOME/.config/plasma-localerc

echo "$(cat /tmp/big_language)" > $HOME/.config/user-dirs.locale

#Apply desktop configuration
change-plasma-theme --apply $(cut -f2 -d" " /etc/big_desktop_changed) clean

chmod +x /tmp/biglightdm
cd ~
/tmp/biglightdm




sudo systemctl restart sddm
