#!/bin/bash
##################################
#  Author1: Bruno Goncalves (www.biglinux.com.br) 
#  Author2: Rafael Ruscher (rruscher@gmail.com)  
#  Date:    2022/08/19
#  
#  Description: Control Center to help usage of BigLinux 
#  
# Licensed by GPL V2 or greater
##################################

export LANGUAGE=$(cat /tmp/big_language).UTF-8
export LANG=$(cat /tmp/big_language).UTF-8

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=biglinux-livecd

# enable swap on disk
for diskswap in $(sudo blkid | grep 'TYPE="swap"' | grep -v zram | cut -f1 -d:)
do
    sudo swapon $diskswap  </dev/null &>/dev/null &
done

# Import BigControlCenter base modules / Importa os módulos básicos do BigControlCenter
# That's include jquery and materialize / Isso inclui o jquery e o materialize
# http://materializecss.com/
. /usr/share/bigbashview/bcc/shell/base.sh

if [ "$keyboard" != "" ]; then

    setxkbmap $keyboard  </dev/null &>/dev/null &
    echo "$keyboard" > /tmp/big_keyboard
else
    if [ -e "/tmp/big_keyboard" ]; then
        setxkbmap $(cat /tmp/big_keyboard)  </dev/null &>/dev/null &
        #localectl set-x11-keymap $(cat /tmp/big_keyboard)
    fi
fi

CHOOSE_THEME=$"Escolha o tema dos aplicativos:"

if [ "$(glxinfo | grep llvmpipe)" != "" ]; then
  NO_OGL=$"Utilizando renderização por software, a qualidade das transparências será reduzida."
fi

cat << EOF

<!DOCTYPE html>
<html>
<head>
  <title>BigLinux</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="theme-style.css">
  <script src='/usr/share/bigbashview/bcc/materialize/js/jquery.js'></script>
  <script  src="theme.script.js"></script>
  <script src="jquery-ui.js"></script>
  <script>
  function closeMessage(el) {
    el.addClass('is-hidden');
  }

  $('.js-messageClose').on('click', function(e) {
    closeMessage($(this).closest('.Message'));
  });

  $('#js-helpMe').on('click', function(e) {
    alert('Precisa criar novamente a ISO');
    closeMessage($(this).closest('.Message'));
  });


  $(document).ready(function() {
    setTimeout(function() {
      //closeMessage($('#js-timer'));
      //closeMessage($('#js-timer2'));
    }, 15000);
  });
  </script>  
</head>
<body>
    <nav>
      <span class="navbutton" title="Language"><a class="top-link-active" href="index.html">
<svg viewBox="0 0 640 512"><path fill="#aaa" d="M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"/></svg>
      </a></span>
      <span class="navbutton" title="Keyboard" style="margin-right: 35px;">
<svg viewBox="0 0 576 512"><path fill="#aaa" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"/></svg>
      </span>

      <span class="navbutton" title="BigLinux" slyte="width: 100px;">
        <img id="biglinuxlogo"  src="icon-logo-biglinux.png">
      </span>      
      
      <span class="navbutton" title="Theme" style="margin-left: 35px;">
<svg viewBox="0 0 512 512"><path fill="currentColor" d="M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"/></svg>
      </span>
      <span class="navbutton" title="Desktop">
<svg viewBox="0 0 576 512"><path  fill="#333" d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"/></svg>
      </span>      
  </nav>
EOF
# Run script to checksum
#nice -n+20 ionice -c 3 ./biglinux-verify-md5sum.sh > /dev/null 2>&1 &

# Add checksum automatic reload
cat << EOF
<script>
  \$( function() {
    \$( "#progressbar" ).progressbar({
      value: 0
    });
  } );
  </script>
    <script type="text/javascript">
        function fileReplaceDiv(i, div, file){
        if(i == true){
            setTimeout
            (
                function()
                {
                    $.ajax({
                        url:file,
                        type:'GET',
                        error: function()  
                        { 
                            console.log("Loop");
                            fileReplaceDiv(true, div, file);
                        },
                        success: function()
                        {
                            \$(div).load(file);
                            fileReplaceDiv(true, div, file);
                        }
                    });
                },
                500
            );
        }
        } 
    </script>
EOF
echo "<script>fileReplaceDiv(true, '#checksum_biglinux', '/tmp/checksum_biglinux.html');</script>"
echo '<div id=checksum_biglinux></div>'
echo '<div id=progressbar><div id=textprogress></div></div>'
# End checksum automatic reload
cat << EOF
    <div style="height: 95%;" class="fc-card animated fadeIn panel" id="fc-main">
        <div class="centretext">
          <div id="desc">
            <h3>$CHOOSE_THEME</h3>
            <h5>$NO_OGL</h5>
          </div>
          <div id="desc">            
            <ul id="menu">
              <li>
                <a href="index.sh.htm?theme=biglinux"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/biglinux.jpg"> <label>BigLinux</label></a>
              </li>
              <li>
                <a href="index.sh.htm?theme=biglinux-dark"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/biglinux-dark.jpg"> <label>BigLinux Dark</label></a>
              </li>              <li>
                <a href="index.sh.htm?theme=breeze"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/breeze.jpg"> <label>Breeze</label></a>
              </li>
              <li>
                <a href="index.sh.htm?theme=breeze-dark"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/breeze-dark.jpg"> <label>Breeze Dark</label></a>
              </li>
              <li>
                <a href="index.sh.htm?theme=fluent-solid"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/fluent-solid.jpg"> <label>Fluent Solid</label></a>
              </li>
              <li>
                <a href="index.sh.htm?theme=fluent-dark-solid"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/fluent-dark-solid.jpg"> <label>Fluent Solid Dark</label></a>
              </li>
              <li>
                <a href="index.sh.htm?theme=fluent"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/fluent.jpg"> <label>Fluent</label></a>
              </li>
              <li>
                <a href="index.sh.htm?theme=fluent-dark"><img src="/usr/share/bigbashview/bcc/apps/biglinux-themes-gui/fluent-dark.jpg"> <label>Fluent Dark</label></a>
              </li>
            </ul>
          </div>        
    </div>
</div>
<!-- partial --> 
</body>
</html>
EOF
